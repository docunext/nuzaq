<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Nuzaq</title>
	<style>
		* { padding: 0px; margin: 0px; }
		body { background: #ccc; }
		canvas { background: #eee; display: block; margin: 0 auto; }
	</style>
</head>
<body>
	<canvas id="myCanvas" width="480" height="360"></canvas>
</body>
<script>
	let canvas = document.getElementById("myCanvas");
	let ctx = canvas.getContext("2d");
	let i = 0;
	let j = 0;
	let ii = 0;
	let jj = 0;
	let width = 13;
	let height = 9;
	let cells = [];
	let snakeHeadX = 0;
	let snakeHeadY = 0;
	let direction = "ArrowRight";
	let snakeLength = 3;
	let snake = [];
	let snakeTail = [];
	let appleX = Math.floor(Math.random() * width + 1);
	let appleY = Math.floor(Math.random() * height + 1);
	
	function checkCell(x, y) {
		if (snakeHeadX == x && snakeHeadY == y) {
			return true;
		}
		if (cells[x] && (cells[x][y] > 0)) {
			return true;
		}
	}
		
	function init() {
		while (j < height) {
			i = 0;
			while (i < width) {
				console.log(i, j);
				cells[i] = cells[i] || [];
				cells[i][j] = 0;
				ctx.beginPath();
				ctx.rect(35 * i + 20,35 * j + 20,25,25);
				ctx.strokeStyle = "#000";
				ctx.stroke();
				ctx.fillStyle = "#fff";
				ctx.fill();
				ctx.closePath();
				i++;
			}
			j++;
		}
	}
	function draw() {
		move();
		ctx.beginPath();
		ctx.rect(35 * snakeHeadX + 20,35 * snakeHeadY + 20,25,25);
		ctx.fillStyle = "#000";
		ctx.fill();
		ctx.closePath();
		if (snake.length > snakeLength) {
			snakeTail = snake.shift(); 
			ctx.beginPath();
			ctx.rect(35 * snakeTail[0] + 20,35 * snakeTail[1] + 20,25,25);
			ctx.fillStyle = "#fff";
			ctx.fill();
			ctx.closePath();
		}
		if (snakeHeadX == appleX && snakeHeadY == appleY) {
			snakeLength++;
			appleX = Math.floor(Math.random() * width);
			appleY = Math.floor(Math.random() * height);
		}
		ctx.beginPath();
		ctx.rect(35 * appleX + 20,35 * appleY + 20,25,25);
		ctx.fillStyle = "#00ff";
		ctx.fill();
		ctx.closePath();
		
	}
	const opposites = {
		"ArrowUp": "ArrowDown",
		"ArrowDown": "ArrowUp",
		"ArrowLeft": "ArrowRight",
		"ArrowRight": "ArrowLeft"
	}
	function setDirection(e) {
		console.log(e.code);
		if (e.code.startsWith("Arrow") && opposites[e.code] !== direction) {
			direction = e.code;
		}
	}
	function move() {
		//console.log(snakeHeadX, snakeHeadY);
		cells[snakeHeadX][snakeHeadY] = snakeLength;
		switch(direction) {
			case "ArrowUp":
				if (snakeHeadY > 0) {
					snakeHeadY = snakeHeadY - 1;
					snake.push([snakeHeadX, snakeHeadY]);
				}
				break;
			case "ArrowDown":
				if (snakeHeadY < height - 1) {
					snakeHeadY = snakeHeadY + 1;
					snake.push([snakeHeadX, snakeHeadY]);
				}
				break;
			case "ArrowLeft":
				if (snakeHeadX > 0) {
					snakeHeadX = snakeHeadX - 1;
					snake.push([snakeHeadX, snakeHeadY]);
				}
				break;
			case "ArrowRight":
				if (snakeHeadX < width - 1) {
					snakeHeadX = snakeHeadX + 1;
					snake.push([snakeHeadX, snakeHeadY]);
				}
				break;
		}
	}
	init();
	let interval = 150;
	setInterval(draw, interval);
	document.addEventListener('keyup', setDirection);
	
</script>
</html>
